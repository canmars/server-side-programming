<%# 
    Ürün Listesi Sayfası
    Controller: productController.index
    Route: GET /products
%>

<h1>Ürünler</h1>

<div class="actions">
    <a href="/products/create" class="btn btn-primary">Yeni Ürün Ekle</a>
</div>

<%# Arama Formu %>
<form method="GET" action="/products" class="search-form">
    <input 
        type="text" 
        name="search" 
        placeholder="Ürün adı veya açıklama ile ara..." 
        value="<%= search || '' %>"
    >
    <button type="submit">Ara</button>
    <% if (search) { %>
        <a href="/products" class="btn-clear">Temizle</a>
    <% } %>
</form>

<%# Ürün Listesi %>
<% if (products && products.length > 0) { %>
    <table class="product-table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Ürün Adı</th>
                <th>Açıklama</th>
                <th>Fiyat</th>
                <th>Stok</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            <% products.forEach(product => { %>
                <tr>
                    <td><%= product.id %></td>
                    <td><%= product.name %></td>
                    <td><%= product.description || '-' %></td>
                    <td><%= parseFloat(product.price).toFixed(2) %> ₺</td>
                    <td><%= product.stock %></td>
                    <td class="actions">
                        <a href="/products/<%= product.id %>" class="btn btn-view">Görüntüle</a>
                        <a href="/products/<%= product.id %>/edit" class="btn btn-edit">Düzenle</a>
                        <form method="POST" action="/products/<%= product.id %>?_method=DELETE" style="display: inline;">
                            <button type="submit" class="btn btn-delete" onclick="return confirm('Bu ürünü silmek istediğinize emin misiniz?')">Sil</button>
                        </form>
                    </td>
                </tr>
            <% }) %>
        </tbody>
    </table>

    <%# Sayfalama Bilgisi %>
    <% if (totalPages > 1) { %>
        <div class="pagination">
            <p>
                Toplam <%= totalProducts %> ürün, 
                Sayfa <%= currentPage %> / <%= totalPages %>
            </p>
            <div class="pagination-links">
                <% if (currentPage > 1) { %>
                    <a href="/products?page=<%= currentPage - 1 %><%= search ? '&search=' + search : '' %>">Önceki</a>
                <% } %>
                
                <% for (let i = 1; i <= totalPages; i++) { %>
                    <% if (i === currentPage) { %>
                        <span class="current-page"><%= i %></span>
                    <% } else { %>
                        <a href="/products?page=<%= i %><%= search ? '&search=' + search : '' %>"><%= i %></a>
                    <% } %>
                <% } %>
                
                <% if (currentPage < totalPages) { %>
                    <a href="/products?page=<%= currentPage + 1 %><%= search ? '&search=' + search : '' %>">Sonraki</a>
                <% } %>
            </div>
        </div>
    <% } %>
<% } else { %>
    <div class="empty-state">
        <p>Henüz ürün bulunmamaktadır.</p>
        <a href="/products/create" class="btn btn-primary">İlk Ürünü Ekle</a>
    </div>
<% } %>

